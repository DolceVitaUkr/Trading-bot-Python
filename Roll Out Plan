Rollout stages (state machine)
Stage 1 – Crypto Paper (Learn)

Paper trade Crypto (Spot by default; Perps/Forex OFF).

Train on live data (15m primary, 5m confirm).

Start paper wallet = $1,000 (segregated “Crypto_Paper”).

Gate to next: hit KPI thresholds (win%, Sharpe, DD).

Stage 2 – Crypto Live (+ Exploration)

Live trade Crypto with real wallet (uses exchange balance, not $1k stub).

Keep exploration paper trades running (≥10% dynamic).

Canary sizing for first 50 trades or 7 days.

Paper wallets for Perps/Forex remain separate.

Stage 3 – Crypto Live + Perps/Forex Paper

Continue Crypto live (+ exploration).

Start Perps_Paper = $1,000, Forex_Paper = $1,000 (two new segregated paper wallets).

Strategy adapters: allow different params per asset class.

Stage 4 – Crypto & Forex Live (+ Options Paper)

Promote Forex to live (own broker/account, independent from Bybit).

Keep ForexOptions_Paper = $1,000 to incubate options strategy.

Exploration for both Crypto & Forex live.

Stage 5 – Full Rollout

Crypto Live + Forex Live; continue learning (online RL) + exploration (≥10%).

Options can be promoted later if KPIs pass.

Capital segregation (no cross-subsidy ever)
Virtual sub-wallets (paper):

Crypto_Paper, Perps_Paper, Forex_Paper, ForexOptions_Paper — each starts at $1,000 when that stage begins.

Real accounts (live):

Crypto/Perps = Bybit accounts (Spot & Perp profiles).

Forex/Options = Separate broker(s) (no balance mixing possible).

Guards

No cross-funding between sub-wallets.

Position/PNL accounting tracked per domain (crypto spot, perps, forex, options).

Exposure caps per domain and per pair (10–15% per pair, 30% total concurrent).

UI: buttons & toggles (zero restarts)
Stage buttons (single-select):

Stage 1: Crypto Paper

Stage 2: Crypto Live

Stage 3: Crypto Live + Perps/Forex Paper

Stage 4: Crypto+Forex Live + Options Paper

Stage 5: Full Rollout

Live toggles (in place, no restart):

Profile: Spot | Perp | Spot+Perp (Crypto domain)

Forex [OFF/ON] (defaults OFF every boot; still monitors existing FX positions)

Options [OFF/ON] (defaults OFF every boot; still monitors existing)

Exploration [% slider] (min 10%, dynamic allowed)

Online Learning [ON/OFF]

Safety prompts

When promoting a domain to live: show KPI gate summary + sizing plan + canary toggle.

On stop: “Close open positions or keep running?” per domain.

Safe-restart semantics (important)
On startup:

Forex/Options trading switches: OFF (no new FX/Options orders by default).

But: system reconciles & monitors any open FX/Options positions, re-attaches missing SL/TP, and can close by risk rules.

Crypto follows last state (paper/live) with canary remembered.

All paper sub-wallets are persisted; no reset unless you click “Reset Wallet”.

Config & state (minimal, explicit)
config.py (new/updated)

ROLLOUT_STAGE = 1..5

EXCHANGE_PROFILE = "spot" | "perp" | "spot+perp"

FOREX_ENABLED = 0 (boot default OFF)

OPTIONS_ENABLED = 0 (boot default OFF)

EXPLORATION_MIN_RATE = 0.10, EXPLORATION_RATE_TARGET = 0.25, EXPLORATION_DYNAMIC = 1

CANARY_RISK_PCT = 0.02, BASE_RISK_PCT = 0.05, SCALE_UP_MAX_PCT = 0.10

Per-domain exposure caps and KPI gates.

runtime state (data/_state/runtime.json)

Last stage, toggles, canary status, exploration window stats.

Open positions snapshot (ids) per domain for reconciliation.

JSON: rollout plan (drop as rollout.json)
json
Copy
Edit
{
  "stages": {
    "1": {"name": "Crypto Paper", "crypto_live": false, "perps_live": false, "forex_live": false, "options_live": false, "paper_wallets": {"Crypto_Paper": 1000}},
    "2": {"name": "Crypto Live + Exploration", "crypto_live": true, "perps_live": false, "forex_live": false, "options_live": false, "paper_wallets": {"Crypto_Paper": "persist"}},
    "3": {"name": "Crypto Live + Perps/Forex Paper", "crypto_live": true, "perps_live": false, "forex_live": false, "options_live": false, "paper_wallets": {"Perps_Paper": 1000, "Forex_Paper": 1000}},
    "4": {"name": "Crypto & Forex Live + Options Paper", "crypto_live": true, "forex_live": true, "options_live": false, "paper_wallets": {"ForexOptions_Paper": 1000}},
    "5": {"name": "Full Rollout", "crypto_live": true, "forex_live": true, "options_live": "optional", "paper_wallets": "persist"}
  },
  "defaults": {
    "exploration_min_rate": 0.10,
    "exploration_target_rate": 0.25,
    "canary_trades": 50,
    "canary_days": 7,
    "exposure_caps": {"per_pair_pct": 0.15, "portfolio_concurrent_pct": 0.30}
  }
}
